<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ title or "Failover Dashboard" }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS global du dashboard -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- JS (optionnel) -->
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>

    <style>
      /* Quelques petits compl√©ments qui s'appuient sur ton style.css existant */

      .container {
          max-width: 980px;
          margin: 0 auto;
      }

      nav {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          align-items: center;
      }

      nav a {
          padding: 6px 10px;
          border-radius: 6px;
          text-decoration: none;
          font-size: 0.9em;
          border: 1px solid transparent;
      }

      nav a:hover {
          background: rgba(88,166,255,0.1);
      }

      nav a.active {
          color: var(--accent);
          border-color: var(--accent);
          background: rgba(88,166,255,0.15);
      }

      .topbar-left {
          font-weight: 600;
          display: flex;
          flex-direction: column;
          gap: 2px;
      }

      .topbar-user {
          font-size: 0.85em;
          color: var(--muted);
      }

      /* Zone logo + titre */
      .topbar-brand {
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .topbar-logo {
          width: 36px;
          height: 36px;
          border-radius: 6px;
          object-fit: contain;
      }

      /* ------------ Petits boutons pour Backup -------------- */
      .btn-small {
          display:inline-block;
          padding:4px 8px;
          font-size:0.75em;
          border-radius:6px;
          text-decoration:none;
          font-weight:600;
          margin-left:4px;
          background:#30363d;
          color:#fff;
      }

      .btn-small:hover {
          opacity:0.85;
      }

      .btn-green {
          background:#3fb950 !important;
      }

      .btn-red {
          background:#f85149 !important;
      }
    </style>
</head>
<body>

<header class="topbar">
    <div class="topbar-left">

        <div class="topbar-brand">
            {# Affiche le logo si le fichier existe dans static/img/logo.png #}
            <img src="{{ url_for('static', filename='img/logo.png') }}"
                 alt="Logo Failover-Pi"
                 class="topbar-logo"
                 onerror="this.style.display='none';">
            <span>Failover-Pi Dashboard</span>
        </div>

        {% if session.get("user") %}
            <span class="topbar-user">
                ‚Äî connect√© : <strong>{{ session["user"]["username"] }}</strong>
                ({{ session["user"]["role"] }})
            </span>
        {% endif %}
    </div>

    <nav>
        {% set endpoint = request.endpoint %}
        {% set user = session.get("user") %}
        {% set role = user["role"] if user else "" %}
        {% set is_admin = (role == "admin") %}

        <a href="{{ url_for('index') }}"
           class="{% if endpoint == 'index' %}active{% endif %}">
           üè† Dashboard
        </a>

        {# Liens r√©serv√©s aux admins #}
        {% if is_admin %}
            <a href="{{ url_for('backup') }}"
               class="{% if endpoint == 'backup' %}active{% endif %}">
               üíæ Backups
            </a>

            <a href="{{ url_for('edit_config') }}"
               class="{% if endpoint == 'edit_config' %}active{% endif %}">
               ‚öôÔ∏è Config
            </a>

            <a href="{{ url_for('diagnostics') }}"
               class="{% if endpoint == 'diagnostics' %}active{% endif %}">
               üîç Diagnostics
            </a>

            <a href="{{ url_for('users') }}"
               class="{% if endpoint == 'users' %}active{% endif %}">
               üë• Utilisateurs
            </a>
        {% endif %}

        {# Liens communs √† tous les utilisateurs connect√©s #}
        {% if user %}
            <a href="{{ url_for('account') }}"
               class="{% if endpoint == 'account' %}active{% endif %}">
               üîê Compte
            </a>
            <a href="{{ url_for('logout') }}">
               üö™ D√©connexion
            </a>
        {% endif %}
    </nav>
</header>

<main class="container">
    {% block content %}{% endblock %}
</main>

</body>
</html>
